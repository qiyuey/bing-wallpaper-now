# 版本 0.3.0 规划 - 功能优化

**版本**: 0.3.0  
**目标发布时间**: 待定  
**重点**: 功能优化，提升用户体验和实用性

## 概述

0.3.0 版本专注于添加用户高频请求的功能，以增强应用的可用性和用户体验。这些功能来自路线图和用户反馈。

## 计划功能

### 1. 🌓 深色模式 / 浅色模式切换

**优先级**: 高  
**复杂度**: 中等  
**预计工作量**: 2-3 天

#### 功能描述
添加系统级和手动主题切换支持，支持深色和浅色模式。

#### 技术方案
- **前端**: 
  - 使用 CSS 变量实现主题颜色
  - 在 React 中创建主题上下文提供者
  - 在设置中添加主题切换 UI 组件
  - 在本地存储中持久化主题偏好
- **后端**: 
  - 在设置存储中添加主题偏好
  - 当系统主题变化时发出主题变更事件

#### 实现细节
```typescript
// 主题类型
type Theme = 'light' | 'dark' | 'system';

// CSS 变量结构
:root[data-theme='light'] {
  --bg-primary: #ffffff;
  --text-primary: #000000;
  // ...
}

:root[data-theme='dark'] {
  --bg-primary: #1a1a1a;
  --text-primary: #ffffff;
  // ...
}
```

#### 验收标准
- [ ] 所有平台上系统主题检测正常工作
- [ ] 设置中可手动切换主题
- [ ] 主题偏好在重启后保持
- [ ] 所有 UI 组件在两种主题下样式正确
- [ ] 主题切换时有流畅的过渡动画
- [ ] 托盘图标根据主题变化（macOS/Windows）

---

### 2. 🔔 新壁纸系统通知

**优先级**: 中等  
**复杂度**: 低  
**预计工作量**: 1-2 天

#### 功能描述
当下载新壁纸或自动更新应用新壁纸时，显示原生系统通知。

#### 技术方案
- **后端**:
  - 使用 Tauri 通知插件（已在依赖中）
  - 壁纸下载成功后发送通知
  - 在设置中添加通知开关
  - 在通知中包含壁纸标题和缩略图

#### 实现细节
```rust
// 通知服务
pub async fn notify_new_wallpaper(
    app: &AppHandle,
    wallpaper: &LocalWallpaper,
) -> Result<()> {
    let settings = get_settings(app).await?;
    
    if settings.enable_notifications {
        app.notification()
            .builder()
            .title("新壁纸可用")
            .body(&wallpaper.title)
            .show()?;
    }
    
    Ok(())
}
```

#### 验收标准
- [ ] 下载新壁纸时显示通知
- [ ] 自动更新设置新壁纸时显示通知
- [ ] 设置中可开关通知功能
- [ ] 通知包含壁纸标题和日期
- [ ] 点击通知显示应用窗口
- [ ] 遵守系统通知偏好设置
- [ ] 在 macOS、Windows 和 Linux 上正常工作

---

### 3. 🌍 多语言支持 (i18n)

**优先级**: 中等  
**复杂度**: 中高  
**预计工作量**: 3-4 天

#### 功能描述
添加国际化支持，初始支持英语和中文。

#### 技术方案
- **前端**:
  - 使用 `react-i18next` 处理 React 组件
  - 将所有 UI 字符串提取到语言文件
  - 在设置中添加语言选择器
  - 首次启动时自动检测系统语言
- **后端**:
  - 在设置中存储语言偏好
  - 根据区域设置处理日期/时间格式

#### 实现细节
```typescript
// 语言文件结构
src/
  locales/
    en/
      common.json
      settings.json
      wallpaper.json
    zh/
      common.json
      settings.json
      wallpaper.json

// i18n 配置
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

i18n
  .use(initReactI18next)
  .init({
    resources: {
      en: { ... },
      zh: { ... }
    },
    lng: 'en',
    fallbackLng: 'en',
  });
```

#### 支持语言（初始）
- English (en)
- 简体中文 (zh-CN)

#### 验收标准
- [ ] 所有 UI 文本可翻译
- [ ] 设置中有语言选择器
- [ ] 系统语言自动检测
- [ ] 语言偏好持久化
- [ ] 日期/时间按区域设置格式化
- [ ] 错误消息已翻译
- [ ] 英语和中文完整翻译
- [ ] README 更新语言信息

---

### 4. ⭐ 壁纸收藏功能

**优先级**: 高  
**复杂度**: 中高  
**预计工作量**: 3-4 天

#### 功能描述
允许用户标记壁纸为收藏，防止被自动清理并提供快速访问。

#### 技术方案
- **数据模型**:
  - 在 `LocalWallpaper` 结构体中添加 `is_favorite` 布尔字段
  - 更新索引管理器以持久化收藏状态
  - 清理操作时排除收藏的壁纸
- **前端**:
  - 在壁纸卡片上添加星标/爱心图标按钮
  - 在主视图中添加"收藏"筛选标签
  - 为收藏壁纸添加视觉指示器
- **后端**:
  - 更新清理逻辑以跳过收藏项
  - 添加 `toggle_favorite` 命令
  - 添加 `get_favorite_wallpapers` 命令

#### 实现细节
```rust
// 数据模型更新
#[derive(Serialize, Deserialize, Clone, Debug)]
pub struct LocalWallpaper {
    // ... 现有字段
    #[serde(default)]
    pub is_favorite: bool,
}

// 新命令
#[tauri::command]
async fn toggle_favorite(
    state: State<'_, AppState>,
    wallpaper_id: String,
) -> Result<bool, String> {
    // 切换收藏状态
}

#[tauri::command]
async fn get_favorite_wallpapers(
    state: State<'_, AppState>,
) -> Result<Vec<LocalWallpaper>, String> {
    // 仅返回收藏的壁纸
}
```

#### UI 设计
```
┌─────────────────────────────────────┐
│ 全部 | 收藏                          │
├─────────────────────────────────────┤
│ ┌───────────┐  ┌───────────┐       │
│ │  [图片]   │  │  [图片]   │       │
│ │    ⭐     │  │    ☆      │       │
│ │  [标题]   │  │  [标题]   │       │
│ └───────────┘  └───────────┘       │
└─────────────────────────────────────┘
```

#### 验收标准
- [ ] 每张壁纸卡片上有星标/爱心按钮
- [ ] 单击切换收藏状态
- [ ] 主视图中有"收藏"筛选标签
- [ ] 收藏壁纸有视觉指示器
- [ ] 收藏壁纸不被自动清理
- [ ] 收藏状态在重启后保持
- [ ] 支持导出/导入收藏
- [ ] UI 显示收藏数量

---

## 实现优先级

基于用户价值和技术依赖：

1. **第一阶段**（高优先级）:
   - 壁纸收藏功能
   - 深色模式 / 浅色模式

2. **第二阶段**（中等优先级）:
   - 系统通知
   - 多语言支持

## 技术考虑

### 数据库架构变更
- 在壁纸元数据中添加 `is_favorite` 字段
- 对现有安装保持向后兼容性

### 设置架构更新
```rust
#[derive(Serialize, Deserialize, Clone)]
pub struct AppSettings {
    // 现有字段...
    
    // v0.3.0 新增字段
    #[serde(default = "default_theme")]
    pub theme: String,  // "light", "dark", "system"
    
    #[serde(default = "default_notifications")]
    pub enable_notifications: bool,
    
    #[serde(default = "default_language")]
    pub language: String,  // "en", "zh-CN"
}
```

### 迁移策略
- 为现有用户提供版本迁移脚本
- 对缺失字段优雅降级
- 应用启动时升级设置

## 测试要求

每个功能必须包含：
- [ ] 核心逻辑单元测试
- [ ] 命令集成测试
- [ ] 前端组件测试
- [ ] 所有平台手动测试（macOS、Windows、Linux）
- [ ] 可访问性测试（特别是主题切换）

## 文档要求

- [ ] 更新 README 新增功能
- [ ] 更新 CHANGELOG 0.3.0 版本
- [ ] 添加新功能用户指南
- [ ] 新命令的 API 文档
- [ ] 开发者指南更新

## 发布检查清单

发布 0.3.0 前：
- [ ] 所有功能实现并测试
- [ ] 无严重 bug
- [ ] 性能基准测试通过
- [ ] 所有平台测试完成
- [ ] 文档完整
- [ ] CHANGELOG 更新
- [ ] GitHub 发布说明准备
- [ ] 所有平台二进制构建成功

## 未来考虑（0.3.0 之后）

考虑在 0.4.0 及以后版本的功能：
- 壁纸幻灯片/轮播
- 自定义壁纸源
- 壁纸分类/标签
- 搜索和筛选改进
- 收藏云同步
- 壁纸编辑工具
- 自定义下载计划
- 多显示器独立壁纸

---

**文档状态**: 草稿  
**最后更新**: 2025-10-28  
**下次审查**: 待定
